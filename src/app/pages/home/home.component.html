<div class="grid h-full grid-cols-4" role="main">
  <div
    id="sidebar"
    class="col-span-1 flex flex-col border-r border-r-gray-400 p-2"
  >
    <div class="mb-2 flex justify-between">
      <a routerLink="/">My Snippets</a>

      <div class="flex">
        <button
          type="button"
          class="inline-flex items-center"
          (click)="createList()"
        >
          <ng-icon
            name="ionAddCircleOutline"
            style="--ng-icon__size: 1.5em"
          ></ng-icon>
        </button>
      </div>
    </div>
    <div class="flex items-center">
      <app-list-group
        [lists]="lists"
        [activeSnippetId]="(activeSnippetId$ | async) || ''"
      ></app-list-group>
    </div>
    <div class="space-between mt-auto flex items-center py-2">
      <img
        [src]="
          'https://ui-avatars.com/api/?name=' +
          (currentUser?.email ?? currentUser?.id)
        "
        class="h-7 w-7 rounded-full"
        alt="User's avatar"
      />
      <button type="button" class="ml-auto" (click)="logout()">Logout</button>
    </div>
  </div>

  <div id="content" class="col-span-3">
    @if (activeSnippet$ | async; as snippet) {
      <app-snippet [snippet]="snippet.data"></app-snippet>
    } @else {
      <app-default-snippet-view />
    }
  </div>
</div>

<ng-template #createListBodyTemplateRef>
  <p class="flex flex-col">
    <input
      type="text"
      class="peer w-full border p-2 text-sm"
      [ngClass]="{
        '!border-red-700': name.invalid && (name.touched || name.dirty)
      }"
      [ngStyle]="{
        '--tw-ring-color': 'transparent'
      }"
      [(ngModel)]="listName"
      required
      #name="ngModel"
    />
    <!-- Add explicit height to prevent UI layout shifts -->
    <span class="block h-[20px] peer-invalid:text-red-700">
      @if (name.invalid && (name.touched || name.dirty)) {
        <span class="text-sm">Name is required</span>
      }
    </span>
  </p>
</ng-template>

<ng-template #searchBodyTemplateRef>
  <div class="flex flex-col">
    <input
      type="text"
      class="peer w-full border p-2 text-sm"
      [(ngModel)]="searchText"
      required
      #name="ngModel"
      placeholder="Search"
      (ngModelChange)="searchSnippets(searchText)"
    />
    @if (searchText) {
      @if (matchingSnippets$ | async; as matchingSnippets) {
        <div class="mt-2 flex flex-col space-y-2 text-sm">
          @for (snippet of matchingSnippets; track snippet.id) {
            <button
              class="text-left"
              type="button"
              (click)="navigateToSnippet(snippet.id)"
            >
              {{ snippet.title }}
            </button>
          }
        </div>
      } @else {
        <div class="text-sm">Searching...</div>
      }
    }
  </div>
</ng-template>
